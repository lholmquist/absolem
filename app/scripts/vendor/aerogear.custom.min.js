/*! AeroGear JavaScript Library - v1.3.0-dev - 2013-11-06
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(e,t){function r(e,t,r){if(4!==t.length)throw new f.exception.invalid("invalid aes block size");var a=e.c[r],s=t[0]^a[0],i=t[r?3:1]^a[1],n=t[2]^a[2];t=t[r?1:3]^a[3];var o,c,h,u,l=a.length/4-2,d=4,p=[0,0,0,0];o=e.n[r],e=o[0];var m=o[1],b=o[2],g=o[3],y=o[4];for(u=0;l>u;u++)o=e[s>>>24]^m[255&i>>16]^b[255&n>>8]^g[255&t]^a[d],c=e[i>>>24]^m[255&n>>16]^b[255&t>>8]^g[255&s]^a[d+1],h=e[n>>>24]^m[255&t>>16]^b[255&s>>8]^g[255&i]^a[d+2],t=e[t>>>24]^m[255&s>>16]^b[255&i>>8]^g[255&n]^a[d+3],d+=4,s=o,i=c,n=h;for(u=0;4>u;u++)p[r?3&-u:u]=y[s>>>24]<<24^y[255&i>>16]<<16^y[255&n>>8]<<8^y[255&t]^a[d++],o=s,s=i,i=n,n=t,t=o;return p}function a(e,t){var r,a,s,i=t.slice(0),n=e.u,o=e.c,c=n[0],h=n[1],f=n[2],u=n[3],l=n[4],d=n[5],p=n[6],m=n[7];for(r=0;64>r;r++)16>r?a=i[r]:(a=i[15&r+1],s=i[15&r+14],a=i[15&r]=0|(a>>>7^a>>>18^a>>>3^a<<25^a<<14)+(s>>>17^s>>>19^s>>>10^s<<15^s<<13)+i[15&r]+i[15&r+9]),a=a+m+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(p^l&(d^p))+o[r],m=p,p=d,d=l,l=0|u+a,u=f,f=h,h=c,c=0|a+(h&f^u&(h^f))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10);n[0]=0|n[0]+c,n[1]=0|n[1]+h,n[2]=0|n[2]+f,n[3]=0|n[3]+u,n[4]=0|n[4]+l,n[5]=0|n[5]+d,n[6]=0|n[6]+p,n[7]=0|n[7]+m}function s(e,t){var r,a=f.random.F[e],s=[];for(r in a)a.hasOwnProperty(r)&&s.push(a[r]);for(r=0;s.length>r;r++)s[r](t)}function i(e){e.c=n(e).concat(n(e)),e.H=new f.cipher.aes(e.c)}function n(e){for(var t=0;4>t&&(e.h[t]=0|e.h[t]+1,!e.h[t]);t++);return e.H.encrypt(e.h)}this.AeroGear={},AeroGear.Core=function(){if(this instanceof AeroGear.Core)throw"Invalid instantiation of base class AeroGear.Core";this.add=function(e){var t,r,a=this[this.collectionName]||{};if(this[this.collectionName]=a,!e)return this;if("string"==typeof e)a[e]=AeroGear[this.lib].adapters[this.type](e,this.config);else if(AeroGear.isArray(e))for(t=0;e.length>t;t++)r=e[t],"string"==typeof r?a[r]=AeroGear[this.lib].adapters[this.type](r,this.config):r.name&&(r.settings=AeroGear.extend(r.settings||{},this.config),r.settings.recordId=r.settings.recordId||r.recordId,a[r.name]=AeroGear[this.lib].adapters[r.type||this.type](r.name,r.settings));else{if(!e.name)return this;e.settings=AeroGear.extend(e.settings||{},this.config),e.settings.recordId=e.settings.recordId||e.recordId,a[e.name]=AeroGear[this.lib].adapters[e.type||this.type](e.name,e.settings)}return this[this.collectionName]=a,this},this.remove=function(e){var t,r,a=this[this.collectionName]||{};if("string"==typeof e)delete a[e];else if(AeroGear.isArray(e))for(t=0;e.length>t;t++)r=e[t],"string"==typeof r?delete a[r]:delete a[r.name];else e&&delete a[e.name];return this[this.collectionName]=a,this}},AeroGear.isArray=function(e){return"[object Array]"==={}.toString.call(e)},AeroGear.extend=function(e,t){var r;for(r in t)e[r]=t[r];return e};var o=void 0,c=!0,h=!1,f={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};"undefined"!=typeof module&&module.exports&&(module.exports=f),f.cipher.aes=function(e){this.n[0][0][0]||this.K();var t,r,a,s,i=this.n[0][4],n=this.n[1];t=e.length;var o=1;if(4!==t&&6!==t&&8!==t)throw new f.exception.invalid("invalid aes key size");for(this.c=[a=e.slice(0),s=[]],e=t;4*t+28>e;e++)r=a[e-1],(0===e%t||8===t&&4===e%t)&&(r=i[r>>>24]<<24^i[255&r>>16]<<16^i[255&r>>8]<<8^i[255&r],0===e%t&&(r=r<<8^r>>>24^o<<24,o=o<<1^283*(o>>7))),a[e]=a[e-t]^r;for(t=0;e;t++,e--)r=a[3&t?e:e-4],s[t]=4>=e||4>t?r:n[0][i[r>>>24]]^n[1][i[255&r>>16]]^n[2][i[255&r>>8]]^n[3][i[255&r]]},f.cipher.aes.prototype={encrypt:function(e){return r(this,e,0)},decrypt:function(e){return r(this,e,1)},n:[[[],[],[],[],[]],[[],[],[],[],[]]],K:function(){var e,t,r,a,s,i,n,o=this.n[0],c=this.n[1],h=o[4],f=c[4],u=[],l=[];for(e=0;256>e;e++)l[(u[e]=e<<1^283*(e>>7))^e]=e;for(t=r=0;!h[t];t^=a||1,r=l[r]||1)for(i=r^r<<1^r<<2^r<<3^r<<4,i=99^(i>>8^255&i),h[t]=i,f[i]=t,s=u[e=u[a=u[t]]],n=16843009*s^65537*e^257*a^16843008*t,s=257*u[i]^16843008*i,e=0;4>e;e++)o[e][t]=s=s<<24^s>>>8,c[e][i]=n=n<<24^n>>>8;for(e=0;5>e;e++)o[e]=o[e].slice(0),c[e]=c[e].slice(0)}},f.bitArray={bitSlice:function(e,t,r){return e=f.bitArray.U(e.slice(t/32),32-(31&t)).slice(1),r===o?e:f.bitArray.clamp(e,r-t)},extract:function(e,t,r){var a=Math.floor(31&-t-r);return(-32&(t+r-1^t)?e[0|t/32]<<32-a^e[0|t/32+1]>>>a:e[0|t/32]>>>a)&(1<<r)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var r=e[e.length-1],a=f.bitArray.getPartial(r);return 32===a?e.concat(t):f.bitArray.U(t,a,0|r,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return 0===t?0:32*(t-1)+f.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(t>32*e.length)return e;e=e.slice(0,Math.ceil(t/32));var r=e.length;return t&=31,r>0&&t&&(e[r-1]=f.bitArray.partial(t,e[r-1]&2147483648>>t-1,1)),e},partial:function(e,t,r){return 32===e?t:(r?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(f.bitArray.bitLength(e)!==f.bitArray.bitLength(t))return h;var r,a=0;for(r=0;e.length>r;r++)a|=e[r]^t[r];return 0===a},U:function(e,t,r,a){var s;for(s=0,a===o&&(a=[]);t>=32;t-=32)a.push(r),r=0;if(0===t)return a.concat(e);for(s=0;e.length>s;s++)a.push(r|e[s]>>>t),r=e[s]<<32-t;return s=e.length?e[e.length-1]:0,e=f.bitArray.getPartial(s),a.push(f.bitArray.partial(31&t+e,t+e>32?r:a.pop(),1)),a},ba:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]}},f.codec.utf8String={fromBits:function(e){var t,r,a="",s=f.bitArray.bitLength(e);for(t=0;s/8>t;t++)0===(3&t)&&(r=e[t/4]),a+=String.fromCharCode(r>>>24),r<<=8;return decodeURIComponent(escape(a))},toBits:function(e){e=unescape(encodeURIComponent(e));var t,r=[],a=0;for(t=0;e.length>t;t++)a=a<<8|e.charCodeAt(t),3===(3&t)&&(r.push(a),a=0);return 3&t&&r.push(f.bitArray.partial(8*(3&t),a)),r}},f.codec.hex={fromBits:function(e){var t,r="";for(t=0;e.length>t;t++)r+=((0|e[t])+0xf00000000000).toString(16).substr(4);return r.substr(0,f.bitArray.bitLength(e)/4)},toBits:function(e){var t,r,a=[];for(e=e.replace(/\s|0x/g,""),r=e.length,e+="00000000",t=0;e.length>t;t+=8)a.push(0^parseInt(e.substr(t,8),16));return f.bitArray.clamp(a,4*r)}},f.hash.sha256=function(e){this.c[0]||this.K(),e?(this.u=e.u.slice(0),this.p=e.p.slice(0),this.k=e.k):this.reset()},f.hash.sha256.hash=function(e){return(new f.hash.sha256).update(e).finalize()},f.hash.sha256.prototype={blockSize:512,reset:function(){return this.u=this.R.slice(0),this.p=[],this.k=0,this},update:function(e){"string"==typeof e&&(e=f.codec.utf8String.toBits(e));var t,r=this.p=f.bitArray.concat(this.p,e);for(t=this.k,e=this.k=t+f.bitArray.bitLength(e),t=-512&512+t;e>=t;t+=512)a(this,r.splice(0,16));return this},finalize:function(){var e,t=this.p,r=this.u,t=f.bitArray.concat(t,[f.bitArray.partial(1,1)]);for(e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(this.k/4294967296)),t.push(0|this.k);t.length;)a(this,t.splice(0,16));return this.reset(),r},R:[],c:[],K:function(){function e(e){return 0|4294967296*(e-Math.floor(e))}var t,r=0,a=2;e:for(;64>r;a++){for(t=2;a>=t*t;t++)if(0===a%t)continue e;8>r&&(this.R[r]=e(Math.pow(a,.5))),this.c[r]=e(Math.pow(a,1/3)),r++}}},f.mode.gcm={name:"gcm",encrypt:function(e,t,r,a,s){var i=t.slice(0);return t=f.bitArray,a=a||[],e=f.mode.gcm.O(c,e,i,a,r,s||128),t.concat(e.data,e.tag)},decrypt:function(e,t,r,a,s){var i=t.slice(0),n=f.bitArray,o=n.bitLength(i);if(s=s||128,a=a||[],o>=s?(t=n.bitSlice(i,o-s),i=n.bitSlice(i,0,o-s)):(t=i,i=[]),e=f.mode.gcm.O(h,e,i,a,r,s),!n.equal(e.tag,t))throw new f.exception.corrupt("gcm: tag doesn't match");return e.data},aa:function(e,t){var r,a,s,i,n,o=f.bitArray.ba;for(s=[0,0,0,0],i=t.slice(0),r=0;128>r;r++){for((a=0!==(e[Math.floor(r/32)]&1<<31-r%32))&&(s=o(s,i)),n=0!==(1&i[3]),a=3;a>0;a--)i[a]=i[a]>>>1|(1&i[a-1])<<31;i[0]>>>=1,n&&(i[0]^=-520093696)}return s},j:function(e,t,r){var a,s=r.length;for(t=t.slice(0),a=0;s>a;a+=4)t[0]^=4294967295&r[a],t[1]^=4294967295&r[a+1],t[2]^=4294967295&r[a+2],t[3]^=4294967295&r[a+3],t=f.mode.gcm.aa(t,e);return t},O:function(e,t,r,a,s,i){var n,o,c,h,u,l,d,p,m=f.bitArray;for(l=r.length,d=m.bitLength(r),p=m.bitLength(a),o=m.bitLength(s),n=t.encrypt([0,0,0,0]),96===o?(s=s.slice(0),s=m.concat(s,[1])):(s=f.mode.gcm.j(n,[0,0,0,0],s),s=f.mode.gcm.j(n,s,[0,0,Math.floor(o/4294967296),4294967295&o])),o=f.mode.gcm.j(n,[0,0,0,0],a),u=s.slice(0),a=o.slice(0),e||(a=f.mode.gcm.j(n,o,r)),h=0;l>h;h+=4)u[3]++,c=t.encrypt(u),r[h]^=c[0],r[h+1]^=c[1],r[h+2]^=c[2],r[h+3]^=c[3];return r=m.clamp(r,d),e&&(a=f.mode.gcm.j(n,o,r)),e=[Math.floor(p/4294967296),4294967295&p,Math.floor(d/4294967296),4294967295&d],a=f.mode.gcm.j(n,a,e),c=t.encrypt(s),a[0]^=c[0],a[1]^=c[1],a[2]^=c[2],a[3]^=c[3],{tag:m.bitSlice(a,0,i),data:r}}},f.misc.hmac=function(e,t){this.Q=t=t||f.hash.sha256;var r,a=[[],[]],s=t.prototype.blockSize/32;for(this.q=[new t,new t],e.length>s&&(e=t.hash(e)),r=0;s>r;r++)a[0][r]=909522486^e[r],a[1][r]=1549556828^e[r];this.q[0].update(a[0]),this.q[1].update(a[1])},f.misc.hmac.prototype.encrypt=f.misc.hmac.prototype.mac=function(e){return e=new this.Q(this.q[0]).update(e).finalize(),new this.Q(this.q[1]).update(e).finalize()},f.misc.pbkdf2=function(e,t,r,a,s){if(r=r||1e3,0>a||0>r)throw f.exception.invalid("invalid params to pbkdf2");"string"==typeof e&&(e=f.codec.utf8String.toBits(e)),"string"==typeof t&&(t=f.codec.utf8String.toBits(t)),s=s||f.misc.hmac,e=new s(e);var i,n,o,c,h=[],u=f.bitArray;for(c=1;(a||1)>32*h.length;c++){for(s=i=e.encrypt(u.concat(t,[c])),n=1;r>n;n++)for(i=e.encrypt(i),o=0;i.length>o;o++)s[o]^=i[o];h=h.concat(s)}return a&&(h=u.clamp(h,a)),h},f.prng=function(e){this.e=[new f.hash.sha256],this.l=[0],this.L=0,this.B={},this.J=0,this.N={},this.T=this.g=this.m=this.$=0,this.c=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.H=o,this.I=e,this.s=h,this.F={progress:{},seeded:{}},this.o=this.Z=0,this.C=1,this.D=2,this.X=65536,this.M=[0,48,64,96,128,192,256,384,512,768,1024],this.Y=3e4,this.W=80},f.prng.prototype={randomWords:function(e,t){var r,a=[];r=this.isReady(t);var s;if(r===this.o)throw new f.exception.notReady("generator isn't seeded");if(r&this.D){r=!(r&this.C),s=[];var o,c=0;for(this.T=s[0]=(new Date).valueOf()+this.Y,o=0;16>o;o++)s.push(0|4294967296*Math.random());for(o=0;this.e.length>o&&(s=s.concat(this.e[o].finalize()),c+=this.l[o],this.l[o]=0,!(!r&&this.L&1<<o));o++);for(this.L>=1<<this.e.length&&(this.e.push(new f.hash.sha256),this.l.push(0)),this.g-=c,c>this.m&&(this.m=c),this.L++,this.c=f.hash.sha256.hash(this.c.concat(s)),this.H=new f.cipher.aes(this.c),r=0;4>r&&(this.h[r]=0|this.h[r]+1,!this.h[r]);r++);}for(r=0;e>r;r+=4)0===(r+1)%this.X&&i(this),s=n(this),a.push(s[0],s[1],s[2],s[3]);return i(this),a.slice(0,e)},setDefaultParanoia:function(e){this.I=e},addEntropy:function(e,t,r){r=r||"user";var a,i,n=(new Date).valueOf(),c=this.B[r],h=this.isReady(),u=0;switch(a=this.N[r],a===o&&(a=this.N[r]=this.$++),c===o&&(c=this.B[r]=0),this.B[r]=(this.B[r]+1)%this.e.length,typeof e){case"number":t===o&&(t=1),this.e[c].update([a,this.J++,1,t,n,1,0|e]);break;case"object":if(r=Object.prototype.toString.call(e),"[object Uint32Array]"===r){for(i=[],r=0;e.length>r;r++)i.push(e[r]);e=i}else for("[object Array]"!==r&&(u=1),r=0;e.length>r&&!u;r++)"number"!=typeof e[r]&&(u=1);if(!u){if(t===o)for(r=t=0;e.length>r;r++)for(i=e[r];i>0;)t++,i>>>=1;this.e[c].update([a,this.J++,2,t,n,e.length].concat(e))}break;case"string":t===o&&(t=e.length),this.e[c].update([a,this.J++,3,t,n,e.length]),this.e[c].update(e);break;default:u=1}if(u)throw new f.exception.bug("random: addEntropy only supports number, array of numbers or string");this.l[c]+=t,this.g+=t,h===this.o&&(this.isReady()!==this.o&&s("seeded",Math.max(this.m,this.g)),s("progress",this.getProgress()))},isReady:function(e){return e=this.M[e!==o?e:this.I],this.m&&this.m>=e?this.l[0]>this.W&&(new Date).valueOf()>this.T?this.D|this.C:this.C:this.g>=e?this.D|this.o:this.o},getProgress:function(e){return e=this.M[e?e:this.I],this.m>=e?1:this.g>e?1:this.g/e},startCollectors:function(){if(!this.s){if(e.addEventListener)e.addEventListener("load",this.v,h),e.addEventListener("mousemove",this.w,h);else{if(!document.attachEvent)throw new f.exception.bug("can't attach event");document.attachEvent("onload",this.v),document.attachEvent("onmousemove",this.w)}this.s=c}},stopCollectors:function(){this.s&&(e.removeEventListener?(e.removeEventListener("load",this.v,h),e.removeEventListener("mousemove",this.w,h)):e.detachEvent&&(e.detachEvent("onload",this.v),e.detachEvent("onmousemove",this.w)),this.s=h)},addEventListener:function(e,t){this.F[e][this.Z++]=t},removeEventListener:function(e,t){var r,a,s=this.F[e],i=[];for(a in s)s.hasOwnProperty(a)&&s[a]===t&&i.push(a);for(r=0;i.length>r;r++)a=i[r],delete s[a]},w:function(e){f.random.addEntropy([e.x||e.clientX||e.offsetX||0,e.y||e.clientY||e.offsetY||0],2,"mouse")},v:function(){f.random.addEntropy((new Date).valueOf(),2,"loadtime")}},f.random=new f.prng(6);try{if("undefined"!=typeof module&&module.exports){var u=require("crypto").randomBytes(128);f.random.addEntropy(u,1024,"crypto['randomBytes']")}else if(e&&e.crypto&&e.crypto.getRandomValues){var l=new Uint32Array(32);e.crypto.getRandomValues(l),f.random.addEntropy(l,1024,"crypto['getRandomValues']")}}catch(d){}f.bn=function(e){this.initWith(e)},f.bn.prototype={radix:24,maxMul:8,d:f.bn,copy:function(){return new this.d(this)},initWith:function(e){var t,r=0;switch(typeof e){case"object":this.limbs=e.limbs.slice(0);break;case"number":this.limbs=[e],this.normalize();break;case"string":for(e=e.replace(/^0x/,""),this.limbs=[],t=this.radix/4,r=0;e.length>r;r+=t)this.limbs.push(parseInt(e.substring(Math.max(e.length-r-t,0),e.length-r),16));break;default:this.limbs=[0]}return this},equals:function(e){"number"==typeof e&&(e=new this.d(e));var t,r=0;for(this.fullReduce(),e.fullReduce(),t=0;this.limbs.length>t||e.limbs.length>t;t++)r|=this.getLimb(t)^e.getLimb(t);return 0===r},getLimb:function(e){return e>=this.limbs.length?0:this.limbs[e]},greaterEquals:function(e){"number"==typeof e&&(e=new this.d(e));var t,r,a,s=0,i=0;for(t=Math.max(this.limbs.length,e.limbs.length)-1;t>=0;t--)r=this.getLimb(t),a=e.getLimb(t),i|=a-r&~s,s|=r-a&~i;return(i|~s)>>>31},toString:function(){this.fullReduce();var e,t,r="",a=this.limbs;for(e=0;this.limbs.length>e;e++){for(t=a[e].toString(16);this.limbs.length-1>e&&6>t.length;)t="0"+t;r=t+r}return"0x"+r},addM:function(e){"object"!=typeof e&&(e=new this.d(e));var t=this.limbs,r=e.limbs;for(e=t.length;r.length>e;e++)t[e]=0;for(e=0;r.length>e;e++)t[e]+=r[e];return this},doubleM:function(){var e,t,r=0,a=this.radix,s=this.radixMask,i=this.limbs;for(e=0;i.length>e;e++)t=i[e],t=t+t+r,i[e]=t&s,r=t>>a;return r&&i.push(r),this},halveM:function(){var e,t,r=0,a=this.radix,s=this.limbs;for(e=s.length-1;e>=0;e--)t=s[e],s[e]=t+r>>1,r=(1&t)<<a;return s[s.length-1]||s.pop(),this},subM:function(e){"object"!=typeof e&&(e=new this.d(e));var t=this.limbs,r=e.limbs;for(e=t.length;r.length>e;e++)t[e]=0;for(e=0;r.length>e;e++)t[e]-=r[e];return this},mod:function(e){var t=!this.greaterEquals(new f.bn(0));e=new f.bn(e).normalize();var r=new f.bn(this).normalize(),a=0;for(t&&(r=new f.bn(0).subM(r).normalize());r.greaterEquals(e);a++)e.doubleM();for(t&&(r=e.sub(r).normalize());a>0;a--)e.halveM(),r.greaterEquals(e)&&r.subM(e).normalize();return r.trim()},inverseMod:function(e){var t,r=new f.bn(1),a=new f.bn(0),s=new f.bn(this),i=new f.bn(e),n=1;if(!(1&e.limbs[0]))throw new f.exception.invalid("inverseMod: p must be odd");do for(1&s.limbs[0]&&(s.greaterEquals(i)||(t=s,s=i,i=t,t=r,r=a,a=t),s.subM(i),s.normalize(),r.greaterEquals(a)||r.addM(e),r.subM(a)),s.halveM(),1&r.limbs[0]&&r.addM(e),r.normalize(),r.halveM(),t=n=0;s.limbs.length>t;t++)n|=s.limbs[t];while(n);if(!i.equals(1))throw new f.exception.invalid("inverseMod: p and x must be relatively prime");return a},add:function(e){return this.copy().addM(e)},sub:function(e){return this.copy().subM(e)},mul:function(e){"number"==typeof e&&(e=new this.d(e));var t,r,a=this.limbs,s=e.limbs,i=a.length,n=s.length,o=new this.d,c=o.limbs,h=this.maxMul;for(t=0;this.limbs.length+e.limbs.length+1>t;t++)c[t]=0;for(t=0;i>t;t++){for(r=a[t],e=0;n>e;e++)c[t+e]+=r*s[e];--h||(h=this.maxMul,o.cnormalize())}return o.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(e){"number"==typeof e?e=[e]:e.limbs!==o&&(e=e.normalize().limbs);var t,r,a=new this.d(1),s=this;for(t=0;e.length>t;t++)for(r=0;this.radix>r;r++)e[t]&1<<r&&(a=a.mul(s)),s=s.square();return a},mulmod:function(e,t){return this.mod(t).mul(e.mod(t)).mod(t)},powermod:function(e,t){for(var r=new f.bn(1),a=new f.bn(this),s=new f.bn(e);1&s.limbs[0]&&(r=r.mulmod(a,t)),s.halveM(),!s.equals(0);)a=a.mulmod(a,t);return r.normalize().reduce()},trim:function(){var e,t=this.limbs;do e=t.pop();while(t.length&&0===e);return t.push(e),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var e,t,r=0,a=this.ipv,s=this.limbs,i=s.length,n=this.radixMask;for(e=0;i>e||0!==r&&-1!==r;e++)r=(s[e]||0)+r,t=s[e]=r&n,r=(r-t)*a;return-1===r&&(s[e-1]-=this.placeVal),this},cnormalize:function(){var e,t,r=0,a=this.ipv,s=this.limbs,i=s.length,n=this.radixMask;for(e=0;i-1>e;e++)r=s[e]+r,t=s[e]=r&n,r=(r-t)*a;return s[e]+=r,this},toBits:function(e){this.fullReduce(),e=e||this.exponent||this.bitLength();var t=Math.floor((e-1)/24),r=f.bitArray,a=[r.partial((-8&e+7)%this.radix||this.radix,this.getLimb(t))];for(t--;t>=0;t--)a=r.concat(a,[r.partial(Math.min(this.radix,e),this.getLimb(t))]),e-=this.radix;return a},bitLength:function(){this.fullReduce();for(var e=this.radix*(this.limbs.length-1),t=this.limbs[this.limbs.length-1];t;t>>>=1)e++;return-8&e+7}},f.bn.fromBits=function(e){var t=new this,r=[],a=f.bitArray,s=this.prototype,i=Math.min(this.bitLength||4294967296,a.bitLength(e)),n=i%s.radix||s.radix;for(r[0]=a.extract(e,0,n);i>n;n+=s.radix)r.unshift(a.extract(e,n,s.radix));return t.limbs=r,t},f.bn.prototype.ipv=1/(f.bn.prototype.placeVal=Math.pow(2,f.bn.prototype.radix)),f.bn.prototype.radixMask=(1<<f.bn.prototype.radix)-1,f.bn.pseudoMersennePrime=function(e,t){function r(e){this.initWith(e)}var a,s,i=r.prototype=new f.bn;for(a=i.modOffset=Math.ceil(s=e/i.radix),i.exponent=e,i.offset=[],i.factor=[],i.minOffset=a,i.fullMask=0,i.fullOffset=[],i.fullFactor=[],i.modulus=r.modulus=new f.bn(Math.pow(2,e)),i.fullMask=0|-Math.pow(2,e%i.radix),a=0;t.length>a;a++)i.offset[a]=Math.floor(t[a][0]/i.radix-s),i.fullOffset[a]=Math.ceil(t[a][0]/i.radix-s),i.factor[a]=t[a][1]*Math.pow(.5,e-t[a][0]+i.offset[a]*i.radix),i.fullFactor[a]=t[a][1]*Math.pow(.5,e-t[a][0]+i.fullOffset[a]*i.radix),i.modulus.addM(new f.bn(Math.pow(2,t[a][0])*t[a][1])),i.minOffset=Math.min(i.minOffset,-i.offset[a]);return i.d=r,i.modulus.cnormalize(),i.reduce=function(){var e,t,r,a,s=this.modOffset,i=this.limbs,n=this.offset,o=this.offset.length,c=this.factor;for(e=this.minOffset;i.length>s;){for(r=i.pop(),a=i.length,t=0;o>t;t++)i[a+n[t]]-=c[t]*r;e--,e||(i.push(0),this.cnormalize(),e=this.minOffset)}return this.cnormalize(),this},i.V=-1===i.fullMask?i.reduce:function(){var e,t,r=this.limbs,a=r.length-1;if(this.reduce(),a===this.modOffset-1){for(t=r[a]&this.fullMask,r[a]-=t,e=0;this.fullOffset.length>e;e++)r[a+this.fullOffset[e]]-=this.fullFactor[e]*t;this.normalize()}},i.fullReduce=function(){var e,t;for(this.V(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this.V(),t=this.limbs.length;this.modOffset>t;t++)this.limbs[t]=0;for(e=this.greaterEquals(this.modulus),t=0;this.limbs.length>t;t++)this.limbs[t]-=this.modulus.limbs[t]*e;return this.cnormalize(),this},i.inverse=function(){return this.power(this.modulus.sub(2))},r.fromBits=f.bn.fromBits,r};var p=f.bn.pseudoMersennePrime;f.bn.prime={p127:p(127,[[0,-1]]),p25519:p(255,[[0,-19]]),p192k:p(192,[[32,-1],[12,-1],[8,-1],[7,-1],[6,-1],[3,-1],[0,-1]]),p224k:p(224,[[32,-1],[12,-1],[11,-1],[9,-1],[7,-1],[4,-1],[1,-1],[0,-1]]),p256k:p(256,[[32,-1],[9,-1],[8,-1],[7,-1],[6,-1],[4,-1],[0,-1]]),p192:p(192,[[0,-1],[64,-1]]),p224:p(224,[[0,1],[96,-1]]),p256:p(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:p(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:p(521,[[0,-1]])},f.bn.random=function(e,t){"object"!=typeof e&&(e=new f.bn(e));for(var r,a,s=e.limbs.length,i=e.limbs[s-1]+1,n=new f.bn;;){do r=f.random.randomWords(s,t),0>r[s-1]&&(r[s-1]+=4294967296);while(Math.floor(r[s-1]/i)===Math.floor(4294967296/i));for(r[s-1]%=i,a=0;s-1>a;a++)r[a]&=e.radixMask;if(n.limbs=r,!n.greaterEquals(e))return n}},f.ecc={},f.ecc.point=function(e,t,r){t===o?this.isIdentity=c:(this.x=t,this.y=r,this.isIdentity=h),this.curve=e},f.ecc.point.prototype={toJac:function(){return new f.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(e){return this.toJac().mult(e,this).toAffine()},mult2:function(e,t,r){return this.toJac().mult2(e,this,t,r).toAffine()},multiples:function(){var e,t,r;if(this.S===o)for(r=this.toJac().doubl(),e=this.S=[new f.ecc.point(this.curve),this,r.toAffine()],t=3;16>t;t++)r=r.add(this),e.push(r.toAffine());return this.S},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return f.bitArray.concat(this.x.toBits(),this.y.toBits())}},f.ecc.pointJac=function(e,t,r,a){t===o?this.isIdentity=c:(this.x=t,this.y=r,this.z=a,this.isIdentity=h),this.curve=e},f.ecc.pointJac.prototype={add:function(e){var t,r,a,s;if(this.curve!==e.curve)throw"sjcl['ecc']['add'](): Points must be on the same curve to add them!";return this.isIdentity?e.toJac():e.isIdentity?this:(t=this.z.square(),r=e.x.mul(t).subM(this.x),r.equals(0)?this.y.equals(e.y.mul(t.mul(this.z)))?this.doubl():new f.ecc.pointJac(this.curve):(t=e.y.mul(t.mul(this.z)).subM(this.y),a=r.square(),e=t.square(),s=r.square().mul(r).addM(this.x.add(this.x).mul(a)),e=e.subM(s),t=this.x.mul(a).subM(e).mul(t),a=this.y.mul(r.square().mul(r)),t=t.subM(a),r=this.z.mul(r),new f.ecc.pointJac(this.curve,e,t,r)))},doubl:function(){if(this.isIdentity)return this;var e=this.y.square(),t=e.mul(this.x.mul(4)),r=e.square().mul(8),e=this.z.square(),a=""+this.curve.a==""+new f.bn(-3)?this.x.sub(e).mul(3).mul(this.x.add(e)):this.x.square().mul(3).add(e.square().mul(this.curve.a)),e=a.square().subM(t).subM(t),t=t.sub(e).mul(a).subM(r),r=this.y.add(this.y).mul(this.z);return new f.ecc.pointJac(this.curve,e,t,r)},toAffine:function(){if(this.isIdentity||this.z.equals(0))return new f.ecc.point(this.curve);var e=this.z.inverse(),t=e.square();return new f.ecc.point(this.curve,this.x.mul(t).fullReduce(),this.y.mul(t.mul(e)).fullReduce())},mult:function(e,t){"number"==typeof e?e=[e]:e.limbs!==o&&(e=e.normalize().limbs);var r,a,s=new f.ecc.point(this.curve).toJac(),i=t.multiples();for(r=e.length-1;r>=0;r--)for(a=f.bn.prototype.radix-4;a>=0;a-=4)s=s.doubl().doubl().doubl().doubl().add(i[15&e[r]>>a]);return s},mult2:function(e,t,r,a){"number"==typeof e?e=[e]:e.limbs!==o&&(e=e.normalize().limbs),"number"==typeof r?r=[r]:r.limbs!==o&&(r=r.normalize().limbs);var s,i=new f.ecc.point(this.curve).toJac();t=t.multiples();var n,c,h=a.multiples();for(a=Math.max(e.length,r.length)-1;a>=0;a--)for(n=0|e[a],c=0|r[a],s=f.bn.prototype.radix-4;s>=0;s-=4)i=i.doubl().doubl().doubl().doubl().add(t[15&n>>s]).add(h[15&c>>s]);return i},isValid:function(){var e=this.z.square(),t=e.square(),e=t.mul(e);return this.y.square().equals(this.curve.b.mul(e).add(this.x.mul(this.curve.a.mul(t).add(this.x.square()))))}},f.ecc.curve=function(e,t,r,a,s,i){this.field=e,this.r=new f.bn(t),this.a=new e(r),this.b=new e(a),this.G=new f.ecc.point(this,new e(s),new e(i))},f.ecc.curve.prototype.fromBits=function(e){var t=f.bitArray,r=-8&this.field.prototype.exponent+7;if(e=new f.ecc.point(this,this.field.fromBits(t.bitSlice(e,0,r)),this.field.fromBits(t.bitSlice(e,r,2*r))),!e.isValid())throw new f.exception.corrupt("not on the curve!");return e},f.ecc.curves={c192:new f.ecc.curve(f.bn.prime.p192,"0xffffffffffffffffffffffff99def836146bc9b1b4d22831",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new f.ecc.curve(f.bn.prime.p224,"0xffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new f.ecc.curve(f.bn.prime.p256,"0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new f.ecc.curve(f.bn.prime.p384,"0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),k192:new f.ecc.curve(f.bn.prime.p192k,"0xfffffffffffffffffffffffe26f2fc170f69466a74defd8d",0,3,"0xdb4ff10ec057e9ae26b07d0280b7f4341da5d1b1eae06c7d","0x9b2f2f6d9c5628a7844163d015be86344082aa88d95e2f9d"),k224:new f.ecc.curve(f.bn.prime.p224k,"0x010000000000000000000000000001dce8d2ec6184caf0a971769fb1f7",0,5,"0xa1455b334df099df30fc28a169a467e9e47075a90f7e650eb6b7a45c","0x7e089fed7fba344282cafbd6f7e319f7c0b0bd59e2ca4bdb556d61a5"),k256:new f.ecc.curve(f.bn.prime.p256k,"0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",0,7,"0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},f.ecc.P=function(e){f.ecc[e]={publicKey:function(e,t){this.f=e,this.i=e.r.bitLength(),this.A=t instanceof Array?e.fromBits(t):t,this.get=function(){var e=this.A.toBits(),t=f.bitArray.bitLength(e),r=f.bitArray.bitSlice(e,0,t/2),e=f.bitArray.bitSlice(e,t/2);return{x:r,y:e}}},secretKey:function(e,t){this.f=e,this.i=e.r.bitLength(),this.t=t,this.get=function(){return this.t.toBits()}},generateKeys:function(t,r,a){if(t===o&&(t=256),"number"==typeof t&&(t=f.ecc.curves["c"+t],t===o))throw new f.exception.invalid("no such curve");return a===o&&(a=f.bn.random(t.r,r)),r=t.G.mult(a),{pub:new f.ecc[e].publicKey(t,r),sec:new f.ecc[e].secretKey(t,a)}}}},f.ecc.P("elGamal"),f.ecc.elGamal.publicKey.prototype={kem:function(e){e=f.bn.random(this.f.r,e);var t=this.f.G.mult(e).toBits();return{key:f.hash.sha256.hash(this.A.mult(e).toBits()),tag:t}}},f.ecc.elGamal.secretKey.prototype={unkem:function(e){return f.hash.sha256.hash(this.f.fromBits(e).mult(this.t).toBits())},dh:function(e){return f.hash.sha256.hash(e.A.mult(this.t).toBits())}},f.ecc.P("ecdsa"),f.ecc.ecdsa.secretKey.prototype={sign:function(e,t,r,a){f.bitArray.bitLength(e)>this.i&&(e=f.bitArray.clamp(e,this.i));var s=this.f.r,i=s.bitLength();return a=a||f.bn.random(s.sub(1),t).add(1),t=this.f.G.mult(a).x.mod(s),e=f.bn.fromBits(e).add(t.mul(this.t)),r=r?e.inverseMod(s).mul(a).mod(s):e.mul(a.inverseMod(s)).mod(s),f.bitArray.concat(t.toBits(i),r.toBits(i))}},f.ecc.ecdsa.publicKey.prototype={verify:function(e,t,r){f.bitArray.bitLength(e)>this.i&&(e=f.bitArray.clamp(e,this.i));var a=f.bitArray,s=this.f.r,i=this.i,n=f.bn.fromBits(a.bitSlice(t,0,i)),a=f.bn.fromBits(a.bitSlice(t,i,2*i)),h=r?a:a.inverseMod(s),i=f.bn.fromBits(e).mul(h).mod(s),h=n.mul(h).mod(s),i=this.f.G.mult2(i,h,this.A).x;if(n.equals(0)||a.equals(0)||n.greaterEquals(s)||a.greaterEquals(s)||!i.equals(n)){if(r===o)return this.verify(e,t,c);throw new f.exception.corrupt("signature didn't check out")}return c}},AeroGear.crypto={},AeroGear.crypto.deriveKey=function(e){var t=f.codec.hex,r=new f.prng(12),a=2048;return f.misc.pbkdf2(e,t.fromBits(r),a)},AeroGear.crypto.encrypt=function(e){e=e||{};var t=f.mode.gcm,r=new f.cipher.aes(e.key);return t.encrypt(r,e.data,e.IV,e.aad,128)},AeroGear.crypto.decrypt=function(e){e=e||{};var t=f.mode.gcm,r=new f.cipher.aes(e.key);return t.decrypt(r,e.data,e.IV,e.aad,128)},AeroGear.crypto.hash=function(e){return f.hash.sha256.hash(e)},AeroGear.crypto.sign=function(e){e=e||{};var t=e.keys||f.ecc.ecdsa.generateKeys(192),r=f.hash.sha256.hash(e.message);return t.sec.sign(r)},AeroGear.crypto.verify=function(e){e=e||{};var t=f.hash.sha256.hash(e.message);return e.keys.pub.verify(t,e.signature)},AeroGear.crypto.KeyPair=function(e,t){var r,a;e&&t?(this.privateKey=e,this.publicKey=t):(r=f.ecc.elGamal.generateKeys(192,0),a=r.pub.kem(),this.publicKey=a.key,this.privateKey=r.sec.unkem(a.tag))},AeroGear.DataManager=function(e){return this instanceof AeroGear.DataManager?(this.add=function(e){e=e||{};var t,r;e=AeroGear.isArray(e)?e:[e],e=e.map(function(e){if("string"!=typeof e&&(r=e.type||"Memory",!(r in AeroGear.DataManager.validAdapters)))for(t=0;AeroGear.DataManager.prefered.length>t;t++)if(AeroGear.DataManager.prefered[t]in AeroGear.DataManager.validAdapters)return("IndexedDB"===r||"WebSQL"===r)&&(e.settings=AeroGear.extend(e.settings||{},{async:!0})),e.type=AeroGear.DataManager.prefered[t],e;return e},this),AeroGear.Core.call(this),this.add(e),this.add=this._add},this._add=this.add,this.remove=function(e){AeroGear.Core.call(this),this.remove(e),this.remove=this._remove},this._remove=this.remove,this.lib="DataManager",this.type=e?e.type||"Memory":"Memory",this.collectionName="stores",this.add(e),t):new AeroGear.DataManager(e)},AeroGear.DataManager.prototype=AeroGear.Core,AeroGear.DataManager.constructor=AeroGear.DataManager,AeroGear.DataManager.validAdapters={},AeroGear.DataManager.prefered=["IndexedDB","WebSQL","SessionLocal","Memory"],AeroGear.DataManager.validateAdapter=function(e,t){t.isValid()&&(AeroGear.DataManager.validAdapters[e]=t)},AeroGear.DataManager.adapters={},AeroGear.DataManager.STATUS_NEW=1,AeroGear.DataManager.STATUS_MODIFIED=2,AeroGear.DataManager.STATUS_REMOVED=0,AeroGear.DataManager.adapters.base=function(e,t){if(this instanceof AeroGear.DataManager.adapters.base)throw"Invalid instantiation of base class AeroGear.DataManager.adapters.base";t=t||{};var r=null,a=t.recordId?t.recordId:"id";this.getData=function(){return r},this.setData=function(e){r=e},this.getRecordId=function(){return a},this.always=function(e,t,r){r&&r.call(this,e,t)}},AeroGear.DataManager.adapters.Memory=function(e,r){return this instanceof AeroGear.DataManager.adapters.Memory?(AeroGear.DataManager.adapters.base.apply(this,arguments),this.emptyData=function(){this.setData(null)},this.addDataRecord=function(e){this.getData().push(e)},this.updateDataRecord=function(e,t){this.getData()[e]=t},this.removeDataRecord=function(e){this.getData().splice(e,1)},this.always=function(e,t,r){r&&r.call(this,e,t)},this.getAsync=function(){return r&&r.async?!0:!1},this.open=function(e){return jQuery.Deferred().resolve(t,"success",e&&e.success)},this.close=function(){},this.traverseObjects=function(e,t,r){for(;"object"==typeof t&&r;)e=Object.keys(t)[0],t=t[e],r=r[e];return t===r?!0:!1},t):new AeroGear.DataManager.adapters.Memory(e,r)},AeroGear.DataManager.adapters.Memory.isValid=function(){return!0},AeroGear.DataManager.adapters.Memory.prototype.read=function(e,r){var a,s={},i=jQuery.Deferred(),n=this.getAsync();return s[this.getRecordId()]=e,e?n?this.filter(s).then(function(e){a=e}):a=this.filter(s):a=this.getData(),n?(i.always(this.always),i.resolve(a,"success",r?r.success:t)):a},AeroGear.DataManager.adapters.Memory.prototype.save=function(e,r){var a=!1,s=jQuery.Deferred(),i=this.getAsync();if(e=AeroGear.isArray(e)?e:[e],r&&r.reset)this.setData(e);else if(this.getData())for(var n=0;e.length>n;n++){for(var o in this.getData())if(this.getData()[o][this.getRecordId()]===e[n][this.getRecordId()]){this.updateDataRecord(o,e[n]),a=!0;
break}a||this.addDataRecord(e[n]),a=!1}else this.setData(e);return i?(s.always(this.always),s.resolve(this.getData(),"success",r?r.success:t)):this.getData()},AeroGear.DataManager.adapters.Memory.prototype.remove=function(e,r){var a,s,i,n=jQuery.Deferred(),o=this.getAsync();if(n.always(this.always),!e)return this.emptyData(),o?n.resolve(this.getData(),"success",r?r.success:t):this.getData();e=AeroGear.isArray(e)?e:[e];for(var c=0;e.length>c;c++){if("string"==typeof e[c]||"number"==typeof e[c])a=e[c];else{if(!e)continue;a=e[c][this.getRecordId()]}s=this.getData(!0);for(i in s)s[i][this.getRecordId()]===a&&this.removeDataRecord(i)}return o?n.resolve(this.getData(),"success",r?r.success:t):this.getData()},AeroGear.DataManager.adapters.Memory.prototype.filter=function(e,r,a){var s,i,n,o,c,h=this,f=jQuery.Deferred(),u=this.getAsync();return f.always(this.always),e?(s=this.getData().filter(function(t){var a,s,f=r?!1:!0,u=Object.keys(e);for(i=0;u.length>i;i++){if(e[u[i]].data)for(a=e[u[i]],s=a.matchAny?!1:!0,n=0;a.data.length>n;n++)if(AeroGear.isArray(t[u[i]]))if(t[u[i]].length){if(0===jQuery(t[u]).not(a.data).length&&0===jQuery(a.data).not(t[u]).length){s=!0;break}for(o=0;t[u[i]].length>o;o++){if(a.matchAny&&a.data[n]===t[u[i]][o]){if(s=!0,r)break;for(c=0;t[u[i]].length>c;c++)if(!r&&a.data[n]!==t[u[i]][c]){s=!1;break}}if(!a.matchAny&&a.data[n]!==t[u[i]][o]){s=!1;break}}}else s=!1;else if("object"==typeof a.data[n]){if(a.matchAny&&h.traverseObjects(u[i],a.data[n],t[u[i]])){s=!0;break}if(!a.matchAny&&!h.traverseObjects(u[i],a.data[n],t[u[i]])){s=!1;break}}else{if(a.matchAny&&a.data[n]===t[u[i]]){s=!0;break}if(!a.matchAny&&a.data[n]!==t[u[i]]){s=!1;break}}else if(AeroGear.isArray(t[u[i]]))if(s=r?!1:!0,t[u[i]].length)for(n=0;t[u[i]].length>n;n++){if(r&&e[u[i]]===t[u[i]][n]){s=!0;break}if(!r&&e[u[i]]!==t[u[i]][n]){s=!1;break}}else s=!1;else s="object"==typeof e[u[i]]?h.traverseObjects(u[i],e[u[i]],t[u[i]]):e[u[i]]===t[u[i]]?!0:!1;if(r&&s){f=!0;break}if(!r&&!s){f=!1;break}}return f}),u?f.resolve(s,"success",a?a.success:t):s):(s=this.getData()||[],u?f.resolve(s,"success",a?a.success:t):s)},AeroGear.DataManager.validateAdapter("Memory",AeroGear.DataManager.adapters.Memory),AeroGear.DataManager.adapters.SessionLocal=function(t,r){if(!(this instanceof AeroGear.DataManager.adapters.SessionLocal))return new AeroGear.DataManager.adapters.SessionLocal(t,r);AeroGear.DataManager.adapters.Memory.apply(this,arguments);var a=r.storageType||"sessionStorage",s=t,i=document.location.pathname.replace(/[\/\.]/g,"-"),n=s+i,o=e[a].getItem(n),c=o?JSON.parse(o):null;c&&AeroGear.DataManager.adapters.Memory.prototype.save.call(this,c,!0),this.getStoreType=function(){return a},this.getStoreKey=function(){return n}},AeroGear.DataManager.adapters.SessionLocal.isValid=function(){return!(!e.localStorage||!e.sessionStorage)},AeroGear.DataManager.adapters.SessionLocal.prototype=Object.create(new AeroGear.DataManager.adapters.Memory,{save:{value:function(r,a){var s,i=jQuery.Deferred(),n=a&&a.reset?a.reset:!1,o=e[this.getStoreType()].getItem(this.getStoreKey()),c=this.getAsync();c?AeroGear.DataManager.adapters.Memory.prototype.save.apply(this,[arguments[0],{reset:n,async:c}]).then(function(e){s=e}):s=AeroGear.DataManager.adapters.Memory.prototype.save.apply(this,[arguments[0],{reset:n}]),i.always(this.always);try{e[this.getStoreType()].setItem(this.getStoreKey(),JSON.stringify(s)),a&&a.success&&a.storageSuccess(s)}catch(h){if(o=o?JSON.parse(o):[],c?AeroGear.DataManager.adapters.Memory.prototype.save.apply(this,[o,{reset:n,async:c}]).then(function(e){s=e}):s=AeroGear.DataManager.adapters.Memory.prototype.save.apply(this,[o,{reset:n}]),a&&a.error)return c?i.reject(r,"error",a?a.error:t):a.error(h,r);throw c&&i.reject(),h}return c?i.resolve(s,"success",a?a.success:t):s},enumerable:!0,configurable:!0,writable:!0},remove:{value:function(r,a){var s,i=jQuery.Deferred(),n=this.getAsync();return n?AeroGear.DataManager.adapters.Memory.prototype.remove.apply(this,[arguments[0],{async:!0}]).then(function(e){s=e}):s=AeroGear.DataManager.adapters.Memory.prototype.remove.apply(this,arguments),e[this.getStoreType()].setItem(this.getStoreKey(),JSON.stringify(s)),n?(i.always(this.always),i.resolve(s,status,a?a.success:t)):s},enumerable:!0,configurable:!0,writable:!0}}),AeroGear.DataManager.validateAdapter("SessionLocal",AeroGear.DataManager.adapters.SessionLocal),AeroGear.DataManager.adapters.IndexedDB=function(t,r){if(!e.indexedDB)throw"Your browser doesn't support IndexedDB";if(!(this instanceof AeroGear.DataManager.adapters.IndexedDB))return new AeroGear.DataManager.adapters.IndexedDB(t,r);AeroGear.DataManager.adapters.base.apply(this,arguments),r=r||{};var a;this.getDatabase=function(){return a},this.setDatabase=function(e){a=e},this.getStoreName=function(){return t},this.getAsync=function(){return!0}},AeroGear.DataManager.adapters.IndexedDB.isValid=function(){return!!e.indexedDB},AeroGear.DataManager.adapters.IndexedDB.prototype.open=function(t){t=t||{};var r,a,s=this,i=this.getStoreName(),n=this.getRecordId(),o=jQuery.Deferred();return r=e.indexedDB.open(i),r.onsuccess=function(e){a=e.target.result,s.setDatabase(a),o.resolve(a,"success",t.success)},r.onerror=function(e){o.reject(e,"error",t.error)},r.onupgradeneeded=function(e){a=e.target.result,a.createObjectStore(i,{keyPath:n})},o.always(this.always),o.promise()},AeroGear.DataManager.adapters.IndexedDB.prototype.read=function(e,t){t=t||{};var r,a,s,i,n=[],o=this.getDatabase(),c=this.getStoreName(),h=jQuery.Deferred();if(!o)throw"Database not opened";return o.objectStoreNames.contains(c)||h.resolve([],"success",t.success),r=o.transaction(c),a=r.objectStore(c),e?(i=a.get(e),i.onsuccess=function(){n.push(i.result)}):(s=a.openCursor(),s.onsuccess=function(e){var t=e.target.result;t&&(n.push(t.value),t.continue())}),r.oncomplete=function(){h.resolve(n,"success",t.success)},r.onerror=function(e){h.reject(e,"error",t.error)},h.always(this.always),h.promise()},AeroGear.DataManager.adapters.IndexedDB.prototype.save=function(e,t){t=t||{};var r,a,s=this,i=this.getDatabase(),n=this.getStoreName(),o=jQuery.Deferred(),c=0;if(!i)throw"Database not opened";if(r=i.transaction(n,"readwrite"),a=r.objectStore(n),t.reset&&a.clear(),AeroGear.isArray(e))for(c;e.length>c;c++)a.put(e[c]);else a.put(e);return r.oncomplete=function(){s.read().done(function(e,r){"success"===r?o.resolve(e,r,t.success):o.reject(e,r,t.error)})},r.onerror=function(e){o.reject(e,"error",t.error)},o.always(this.always),o.promise()},AeroGear.DataManager.adapters.IndexedDB.prototype.remove=function(e,t){t=t||{};var r,a,s=this,i=this.getDatabase(),n=this.getStoreName(),o=jQuery.Deferred(),c=0;if(!i)throw"Database not opened";if(a=i.transaction(n,"readwrite"),r=a.objectStore(n),e)for(e=AeroGear.isArray(e)?e:[e],c;e.length>c;c++)if("string"==typeof e[c]||"number"==typeof e[c])r.delete(e[c]);else{if(!e)continue;r.delete(e[c][this.getRecordId()])}else r.clear();return a.oncomplete=function(){s.read().done(function(e,r){"success"===r?o.resolve(e,r,t.success):o.reject(e,r,t.error)})},a.onerror=function(e){o.reject(e,"error",t.error)},o.always(this.always),o.promise()},AeroGear.DataManager.adapters.IndexedDB.prototype.filter=function(e,r,a){a=a||{};var s=this,i=jQuery.Deferred(),n=this.getDatabase();if(!n)throw"Database not opened";return this.read().then(function(n,o){return"success"!==o?(i.reject(n,o,a.error),t):(AeroGear.DataManager.adapters.Memory.prototype.save.call(s,n,!0),AeroGear.DataManager.adapters.Memory.prototype.filter.call(s,e,r).then(function(e){i.resolve(e,"success",a.success)}),t)}),i.always(this.always),i.promise()},AeroGear.DataManager.adapters.IndexedDB.prototype.close=function(){var e=this.getDatabase();e&&e.close()},AeroGear.DataManager.validateAdapter("IndexedDB",AeroGear.DataManager.adapters.IndexedDB),AeroGear.DataManager.adapters.WebSQL=function(t,r){if(!e.openDatabase)throw"Your browser doesn't support WebSQL";if(!(this instanceof AeroGear.DataManager.adapters.WebSQL))return new AeroGear.DataManager.adapters.WebSQL(t,r);AeroGear.DataManager.adapters.base.apply(this,arguments),r=r||{};var a;this.getDatabase=function(){return a},this.setDatabase=function(e){a=e},this.getStoreName=function(){return t},this.getAsync=function(){return!0}},AeroGear.DataManager.adapters.WebSQL.isValid=function(){return!!e.openDatabase},AeroGear.DataManager.adapters.WebSQL.prototype.open=function(t){t=t||{};var r,a,s,i=this,n="1",o=2097152,c=this.getRecordId(),h=this.getStoreName(),f=jQuery.Deferred();return s=e.openDatabase(h,n,"AeroGear WebSQL Store",o),a=function(e,r){f.reject(r,"error",t.error)},r=function(){i.setDatabase(s),f.resolve(s,"success",t.success)},s.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS "+h+" ( "+c+" REAL UNIQUE, json)",[],r,a)}),f.always(this.always),f.promise()},AeroGear.DataManager.adapters.WebSQL.prototype.read=function(e,t){t=t||{};var r,a,s,i=[],n=this.getStoreName(),o=this.getDatabase(),c=jQuery.Deferred(),h=0;if(!o)throw"Database not opened";return a=function(e,r){c.reject(r,"error",t.error)},r=function(e,r){var a=r.rows.length;for(h;a>h;h++)i.push(JSON.parse(r.rows.item(h).json));c.resolve(i,"success",t.success)},s="SELECT * FROM "+n,e&&(s+=" WHERE ID = "+e),o.transaction(function(e){e.executeSql(s,[],r,a)}),c.always(this.always),c.promise()},AeroGear.DataManager.adapters.WebSQL.prototype.save=function(e,t){t=t||{};var r,a,s=this,i=this.getRecordId(),n=this.getDatabase(),o=this.getStoreName(),c=jQuery.Deferred();if(!n)throw"Database not opened";return r=function(e,r){c.reject(r,"error",t.error)},a=function(){s.read().done(function(e,r){"success"===r?c.resolve(e,r,t.success):c.reject(e,r,t.error)})},e=AeroGear.isArray(e)?e:[e],n.transaction(function(r){t.reset&&(r.executeSql("DROP TABLE "+o),r.executeSql("CREATE TABLE IF NOT EXISTS "+o+" ( "+i+" REAL UNIQUE, json)")),e.forEach(function(e){r.executeSql("INSERT OR REPLACE INTO "+o+" ( id, json ) VALUES ( ?, ? ) ",[e[i],JSON.stringify(e)])})},r,a),c.always(this.always),c.promise()},AeroGear.DataManager.adapters.WebSQL.prototype.remove=function(e,t){t=t||{};var r,a,s,i=this,n=this.getStoreName(),o=this.getDatabase(),c=jQuery.Deferred(),h=0;if(!o)throw"Database not opened";return s=function(e,r){c.reject(r,"error",t.error)},a=function(){i.read().done(function(e,r){"success"===r?c.resolve(e,r,t.success):c.reject(e,r,t.error)})},r="DELETE FROM "+n,e?(e=AeroGear.isArray(e)?e:[e],o.transaction(function(t){for(h;e.length>h;h++)if("string"==typeof e[h]||"number"==typeof e[h])t.executeSql(r+" WHERE ID = ? ",[e[h]]);else{if(!e)continue;t.executeSql(r+" WHERE ID = ? ",[e[h][this.getRecordId()]])}},s,a)):o.transaction(function(e){e.executeSql(r,[],a,s)}),c.always(this.always),c.promise()},AeroGear.DataManager.adapters.WebSQL.prototype.filter=function(e,r,a){a=a||{};var s=this,i=jQuery.Deferred(),n=this.getDatabase();if(!n)throw"Database not opened";return this.read().then(function(n,o){return"success"!==o?(i.reject(n,o,a.error),t):(AeroGear.DataManager.adapters.Memory.prototype.save.call(s,n,!0),AeroGear.DataManager.adapters.Memory.prototype.filter.call(s,e,r).then(function(e){i.resolve(e,"success",a.success)}),t)}),i.always(this.always),i.promise()},AeroGear.DataManager.validateAdapter("WebSQL",AeroGear.DataManager.adapters.WebSQL)})(this);
//@ sourceMappingURL=aerogear.js.map